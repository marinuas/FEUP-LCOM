<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Space Jetpack: Referência ao ficheiro código/keyboard.h</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Space Jetpack
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Gerado por Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Localizar');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Localizar');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ea7eb8caaa87dd07e892caf17a97e648.html">código</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Funções</a>  </div>
  <div class="headertitle">
<div class="title">Referência ao ficheiro keyboard.h</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;lcom/lcf.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &quot;<a class="el" href="i8042_8h_source.html">i8042.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="i8254_8h_source.html">i8254.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="timer_8h_source.html">timer.h</a>&quot;</code><br />
</div>
<p><a href="keyboard_8h_source.html">Ir para o código fonte deste ficheiro.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Funções</h2></td></tr>
<tr class="memitem:a4ac9231a99a664d6a9f0b69767e0d707"><td class="memItemLeft" align="right" valign="top">int()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8h.html#a4ac9231a99a664d6a9f0b69767e0d707">kbd_subscribe_int</a> (uint8_t *bit_no)</td></tr>
<tr class="memdesc:a4ac9231a99a664d6a9f0b69767e0d707"><td class="mdescLeft">&#160;</td><td class="mdescRight">Função que subscreve as interrupções do teclado.  <a href="keyboard_8h.html#a4ac9231a99a664d6a9f0b69767e0d707">Mais...</a><br /></td></tr>
<tr class="separator:a4ac9231a99a664d6a9f0b69767e0d707"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee0a7b54ee426fade9c780418d110fe0"><td class="memItemLeft" align="right" valign="top">int()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8h.html#aee0a7b54ee426fade9c780418d110fe0">kbd_unsubscribe_int</a> ()</td></tr>
<tr class="memdesc:aee0a7b54ee426fade9c780418d110fe0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Função que cancela a subscrição das interrupções do teclado.  <a href="keyboard_8h.html#aee0a7b54ee426fade9c780418d110fe0">Mais...</a><br /></td></tr>
<tr class="separator:aee0a7b54ee426fade9c780418d110fe0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea970a154161a35f6894898a092ed70a"><td class="memItemLeft" align="right" valign="top">void()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8h.html#aea970a154161a35f6894898a092ed70a">kbc_ih</a> ()</td></tr>
<tr class="memdesc:aea970a154161a35f6894898a092ed70a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Função que chama o <a class="el" href="keyboard_8h.html#abba7b628c6f4f364050f0e43ac59793c" title="Manipulador de interrupção do teclado.">read_kbc()</a>  <a href="keyboard_8h.html#aea970a154161a35f6894898a092ed70a">Mais...</a><br /></td></tr>
<tr class="separator:aea970a154161a35f6894898a092ed70a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abba7b628c6f4f364050f0e43ac59793c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8h.html#abba7b628c6f4f364050f0e43ac59793c">read_kbc</a> ()</td></tr>
<tr class="memdesc:abba7b628c6f4f364050f0e43ac59793c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Manipulador de interrupção do teclado.  <a href="keyboard_8h.html#abba7b628c6f4f364050f0e43ac59793c">Mais...</a><br /></td></tr>
<tr class="separator:abba7b628c6f4f364050f0e43ac59793c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a706c1f6ca100e7d2c6d97022abacf787"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8h.html#a706c1f6ca100e7d2c6d97022abacf787">size</a> (uint8_t <a class="el" href="proj_8c.html#a325819a8e492ac69542e8b31705af6e9">data</a>)</td></tr>
<tr class="memdesc:a706c1f6ca100e7d2c6d97022abacf787"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retorna tamanho do scancode.  <a href="keyboard_8h.html#a706c1f6ca100e7d2c6d97022abacf787">Mais...</a><br /></td></tr>
<tr class="separator:a706c1f6ca100e7d2c6d97022abacf787"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a394fe185042339aa2037c4d1699c60c4"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8h.html#a394fe185042339aa2037c4d1699c60c4">isMake</a> (uint8_t <a class="el" href="proj_8c.html#a325819a8e492ac69542e8b31705af6e9">data</a>)</td></tr>
<tr class="memdesc:a394fe185042339aa2037c4d1699c60c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verifica se é makecode ou breakcode.  <a href="keyboard_8h.html#a394fe185042339aa2037c4d1699c60c4">Mais...</a><br /></td></tr>
<tr class="separator:a394fe185042339aa2037c4d1699c60c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac299d32b537c85d49ab998a5362d7f1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8h.html#aac299d32b537c85d49ab998a5362d7f1">get_data</a> ()</td></tr>
<tr class="memdesc:aac299d32b537c85d49ab998a5362d7f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Manipulador de pooling do teclado.  <a href="keyboard_8h.html#aac299d32b537c85d49ab998a5362d7f1">Mais...</a><br /></td></tr>
<tr class="separator:aac299d32b537c85d49ab998a5362d7f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1aeb16539391e388a961b0e24e4779a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8h.html#ac1aeb16539391e388a961b0e24e4779a">read_kbc_poll</a> ()</td></tr>
<tr class="memdesc:ac1aeb16539391e388a961b0e24e4779a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Manipulador de pooling do teclado.  <a href="keyboard_8h.html#ac1aeb16539391e388a961b0e24e4779a">Mais...</a><br /></td></tr>
<tr class="separator:ac1aeb16539391e388a961b0e24e4779a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e4cc2a199eaa58c1a2a07a58d90c522"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8h.html#a1e4cc2a199eaa58c1a2a07a58d90c522">write_command</a> ()</td></tr>
<tr class="memdesc:a1e4cc2a199eaa58c1a2a07a58d90c522"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reativa teclado.  <a href="keyboard_8h.html#a1e4cc2a199eaa58c1a2a07a58d90c522">Mais...</a><br /></td></tr>
<tr class="separator:a1e4cc2a199eaa58c1a2a07a58d90c522"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Documentação das funções</h2>
<a id="aac299d32b537c85d49ab998a5362d7f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac299d32b537c85d49ab998a5362d7f1">&#9670;&nbsp;</a></span>get_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void get_data </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Manipulador de pooling do teclado. </p>
<div class="fragment"><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;               {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="keyboard_8c.html#a8a05c554fb2649cc572632827dfe0060">twobyte</a> == <span class="keyword">true</span>){</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="keyboard_8c.html#aa0321c846802c3ce3f15e6cd6922b1cf">arr</a>[1] = <a class="code" href="keyboard_8c.html#a325819a8e492ac69542e8b31705af6e9">data</a>;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="keyboard_8c.html#a8a05c554fb2649cc572632827dfe0060">twobyte</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="keyboard_8c.html#a325819a8e492ac69542e8b31705af6e9">data</a> == <a class="code" href="i8042_8h.html#a73d6572224ad0ac84a8587615cef947c">FIRST_BYTE</a>){</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="keyboard_8c.html#aa0321c846802c3ce3f15e6cd6922b1cf">arr</a>[0]=<a class="code" href="keyboard_8c.html#a325819a8e492ac69542e8b31705af6e9">data</a>;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="keyboard_8c.html#a8a05c554fb2649cc572632827dfe0060">twobyte</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  }</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <a class="code" href="keyboard_8c.html#aa0321c846802c3ce3f15e6cd6922b1cf">arr</a>[0] = <a class="code" href="keyboard_8c.html#a325819a8e492ac69542e8b31705af6e9">data</a>;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a394fe185042339aa2037c4d1699c60c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a394fe185042339aa2037c4d1699c60c4">&#9670;&nbsp;</a></span>isMake()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isMake </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Verifica se é makecode ou breakcode. </p>
<dl class="params"><dt>Parâmetros</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>- valor do byte do scancode </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                         {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="keyboard_8c.html#a325819a8e492ac69542e8b31705af6e9">data</a> &amp; BIT(7))</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aea970a154161a35f6894898a092ed70a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea970a154161a35f6894898a092ed70a">&#9670;&nbsp;</a></span>kbc_ih()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void() kbc_ih </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Função que chama o <a class="el" href="keyboard_8h.html#abba7b628c6f4f364050f0e43ac59793c" title="Manipulador de interrupção do teclado.">read_kbc()</a> </p>
<div class="fragment"><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                {</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <a class="code" href="keyboard_8c.html#abba7b628c6f4f364050f0e43ac59793c">read_kbc</a>();</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a4ac9231a99a664d6a9f0b69767e0d707"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ac9231a99a664d6a9f0b69767e0d707">&#9670;&nbsp;</a></span>kbd_subscribe_int()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int() kbd_subscribe_int </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>bit_no</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Função que subscreve as interrupções do teclado. </p>
<dl class="params"><dt>Parâmetros</dt><dd>
  <table class="params">
    <tr><td class="paramname">-</td><td>Contem o endereço do bit de interrupção </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;                                         {</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    *bit_no = <a class="code" href="keyboard_8c.html#a7d15e4ad49d56102e73bfb92c6e43a22">hook_id_kbd</a>;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    <span class="keywordflow">if</span>(sys_irqsetpolicy(<a class="code" href="i8042_8h.html#a37360776bcc1dd3b5da93b025177551f">IRQ1</a>, IRQ_REENABLE|IRQ_EXCLUSIVE, &amp;<a class="code" href="keyboard_8c.html#a7d15e4ad49d56102e73bfb92c6e43a22">hook_id_kbd</a>) != 0)</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;      <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160; </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aee0a7b54ee426fade9c780418d110fe0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee0a7b54ee426fade9c780418d110fe0">&#9670;&nbsp;</a></span>kbd_unsubscribe_int()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int() kbd_unsubscribe_int </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Função que cancela a subscrição das interrupções do teclado. </p>
<div class="fragment"><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;                            {</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="keywordflow">if</span>(sys_irqrmpolicy(&amp;<a class="code" href="keyboard_8c.html#a7d15e4ad49d56102e73bfb92c6e43a22">hook_id_kbd</a>) != 0)</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;      <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="abba7b628c6f4f364050f0e43ac59793c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abba7b628c6f4f364050f0e43ac59793c">&#9670;&nbsp;</a></span>read_kbc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int read_kbc </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Manipulador de interrupção do teclado. </p>
<div class="fragment"><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;              {</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  uint8_t stat;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="keywordflow">while</span>( 1 ) {</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="utils_8c.html#a82a2a61273cf5ac5e31ca3eca5a24cea">util_sys_inb</a>(<a class="code" href="i8042_8h.html#a1f7e79cfe81dc06414550fa52418941e">STATUS_REG</a>, &amp;stat)!=0) <span class="keywordflow">return</span> 1; <span class="comment">/* assuming it returns OK */</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">/* loop while 8042 output buffer is empty */</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordflow">if</span>( stat &amp; <a class="code" href="i8042_8h.html#a45967c9e25447ba853cf6fb4ac545fe6">OBF</a> ) {</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="utils_8c.html#a82a2a61273cf5ac5e31ca3eca5a24cea">util_sys_inb</a>(<a class="code" href="i8042_8h.html#acfb42dde389e8ca36ab267002fbf5c6a">OUT_BUF</a>, &amp;<a class="code" href="keyboard_8c.html#a325819a8e492ac69542e8b31705af6e9">data</a>)!=0) <span class="keywordflow">return</span> 1; <span class="comment">/* ass. it returns OK */</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        <span class="keywordflow">if</span> ( (stat &amp;(<a class="code" href="i8042_8h.html#a81d2ca6759f3f3bf04556b7558aea6bc">PARITY_ERROR</a>| <a class="code" href="i8042_8h.html#aefc48d416c882f06edaf6d01779d4d74">TIMEOUT_ERROR</a>) ) == 0 ){</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="keyboard_8c.html#a325819a8e492ac69542e8b31705af6e9">data</a>;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        }</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;          <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    }</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    tickdelay(micros_to_ticks(<a class="code" href="i8042_8h.html#a1a522aa19bcb695a9df30032a893bee3">DELAY_US</a>)); </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  }</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac1aeb16539391e388a961b0e24e4779a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1aeb16539391e388a961b0e24e4779a">&#9670;&nbsp;</a></span>read_kbc_poll()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int read_kbc_poll </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Manipulador de pooling do teclado. </p>
<div class="fragment"><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                   {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  uint8_t stat;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordflow">while</span>( 1 ) {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="utils_8c.html#a82a2a61273cf5ac5e31ca3eca5a24cea">util_sys_inb</a>(<a class="code" href="i8042_8h.html#a1f7e79cfe81dc06414550fa52418941e">STATUS_REG</a>, &amp;stat)!=0) <span class="keywordflow">return</span> 1; <span class="comment">/* assuming it returns OK */</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">/* loop while 8042 output buffer is empty */</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">if</span>( stat &amp; <a class="code" href="i8042_8h.html#a45967c9e25447ba853cf6fb4ac545fe6">OBF</a> ) {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="utils_8c.html#a82a2a61273cf5ac5e31ca3eca5a24cea">util_sys_inb</a>(<a class="code" href="i8042_8h.html#acfb42dde389e8ca36ab267002fbf5c6a">OUT_BUF</a>, &amp;<a class="code" href="keyboard_8c.html#a325819a8e492ac69542e8b31705af6e9">data</a>)!=0) <span class="keywordflow">return</span> 1; <span class="comment">/* ass. it returns OK */</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;          <span class="keywordflow">if</span> ( (stat &amp;(<a class="code" href="i8042_8h.html#a81d2ca6759f3f3bf04556b7558aea6bc">PARITY_ERROR</a>| <a class="code" href="i8042_8h.html#aefc48d416c882f06edaf6d01779d4d74">TIMEOUT_ERROR</a>| <a class="code" href="i8042_8h.html#a1b41fd2be63532d4ab910f8b256c3811">AUX</a>) ) == 0 ){</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="keyboard_8c.html#a325819a8e492ac69542e8b31705af6e9">data</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;          }</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    tickdelay(micros_to_ticks(<a class="code" href="i8042_8h.html#a1a522aa19bcb695a9df30032a893bee3">DELAY_US</a>)); </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a706c1f6ca100e7d2c6d97022abacf787"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a706c1f6ca100e7d2c6d97022abacf787">&#9670;&nbsp;</a></span>size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int size </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retorna tamanho do scancode. </p>
<dl class="params"><dt>Parâmetros</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>- valor do byte do scancode </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                      {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(<a class="code" href="keyboard_8c.html#a325819a8e492ac69542e8b31705af6e9">data</a>);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1e4cc2a199eaa58c1a2a07a58d90c522"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e4cc2a199eaa58c1a2a07a58d90c522">&#9670;&nbsp;</a></span>write_command()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int write_command </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reativa teclado. </p>
<div class="fragment"><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                   {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  uint8_t st;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  sys_outb(<a class="code" href="i8042_8h.html#a1f7e79cfe81dc06414550fa52418941e">STATUS_REG</a>, <a class="code" href="i8042_8h.html#a305ee86129081b404b151c64293566e7">READ_COMMAND_BYTE</a>);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <a class="code" href="utils_8c.html#a82a2a61273cf5ac5e31ca3eca5a24cea">util_sys_inb</a>(<a class="code" href="i8042_8h.html#acfb42dde389e8ca36ab267002fbf5c6a">OUT_BUF</a>, &amp;st);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  st = st | BIT(0);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  sys_outb(<a class="code" href="i8042_8h.html#a1f7e79cfe81dc06414550fa52418941e">STATUS_REG</a>, <a class="code" href="i8042_8h.html#a4680153f26a3244682a2e2e01e57e318">WRITE_COMMAND_BYTE</a>);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  sys_outb(<a class="code" href="i8042_8h.html#acfb42dde389e8ca36ab267002fbf5c6a">OUT_BUF</a>, st);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<div class="ttc" id="akeyboard_8c_html_a8a05c554fb2649cc572632827dfe0060"><div class="ttname"><a href="keyboard_8c.html#a8a05c554fb2649cc572632827dfe0060">twobyte</a></div><div class="ttdeci">bool twobyte</div><div class="ttdef"><b>Definition:</b> keyboard.c:12</div></div>
<div class="ttc" id="ai8042_8h_html_a37360776bcc1dd3b5da93b025177551f"><div class="ttname"><a href="i8042_8h.html#a37360776bcc1dd3b5da93b025177551f">IRQ1</a></div><div class="ttdeci">#define IRQ1</div><div class="ttdef"><b>Definition:</b> i8042.h:9</div></div>
<div class="ttc" id="akeyboard_8c_html_aa0321c846802c3ce3f15e6cd6922b1cf"><div class="ttname"><a href="keyboard_8c.html#aa0321c846802c3ce3f15e6cd6922b1cf">arr</a></div><div class="ttdeci">uint8_t arr[2]</div><div class="ttdef"><b>Definition:</b> keyboard.c:11</div></div>
<div class="ttc" id="ai8042_8h_html_a1b41fd2be63532d4ab910f8b256c3811"><div class="ttname"><a href="i8042_8h.html#a1b41fd2be63532d4ab910f8b256c3811">AUX</a></div><div class="ttdeci">#define AUX</div><div class="ttdef"><b>Definition:</b> i8042.h:25</div></div>
<div class="ttc" id="ai8042_8h_html_a4680153f26a3244682a2e2e01e57e318"><div class="ttname"><a href="i8042_8h.html#a4680153f26a3244682a2e2e01e57e318">WRITE_COMMAND_BYTE</a></div><div class="ttdeci">#define WRITE_COMMAND_BYTE</div><div class="ttdef"><b>Definition:</b> i8042.h:31</div></div>
<div class="ttc" id="ai8042_8h_html_a305ee86129081b404b151c64293566e7"><div class="ttname"><a href="i8042_8h.html#a305ee86129081b404b151c64293566e7">READ_COMMAND_BYTE</a></div><div class="ttdeci">#define READ_COMMAND_BYTE</div><div class="ttdef"><b>Definition:</b> i8042.h:30</div></div>
<div class="ttc" id="ai8042_8h_html_a73d6572224ad0ac84a8587615cef947c"><div class="ttname"><a href="i8042_8h.html#a73d6572224ad0ac84a8587615cef947c">FIRST_BYTE</a></div><div class="ttdeci">#define FIRST_BYTE</div><div class="ttdef"><b>Definition:</b> i8042.h:19</div></div>
<div class="ttc" id="ai8042_8h_html_a81d2ca6759f3f3bf04556b7558aea6bc"><div class="ttname"><a href="i8042_8h.html#a81d2ca6759f3f3bf04556b7558aea6bc">PARITY_ERROR</a></div><div class="ttdeci">#define PARITY_ERROR</div><div class="ttdef"><b>Definition:</b> i8042.h:22</div></div>
<div class="ttc" id="ai8042_8h_html_aefc48d416c882f06edaf6d01779d4d74"><div class="ttname"><a href="i8042_8h.html#aefc48d416c882f06edaf6d01779d4d74">TIMEOUT_ERROR</a></div><div class="ttdeci">#define TIMEOUT_ERROR</div><div class="ttdef"><b>Definition:</b> i8042.h:23</div></div>
<div class="ttc" id="akeyboard_8c_html_a7d15e4ad49d56102e73bfb92c6e43a22"><div class="ttname"><a href="keyboard_8c.html#a7d15e4ad49d56102e73bfb92c6e43a22">hook_id_kbd</a></div><div class="ttdeci">int hook_id_kbd</div><div class="ttdef"><b>Definition:</b> keyboard.c:9</div></div>
<div class="ttc" id="ai8042_8h_html_a1a522aa19bcb695a9df30032a893bee3"><div class="ttname"><a href="i8042_8h.html#a1a522aa19bcb695a9df30032a893bee3">DELAY_US</a></div><div class="ttdeci">#define DELAY_US</div><div class="ttdef"><b>Definition:</b> i8042.h:14</div></div>
<div class="ttc" id="ai8042_8h_html_a45967c9e25447ba853cf6fb4ac545fe6"><div class="ttname"><a href="i8042_8h.html#a45967c9e25447ba853cf6fb4ac545fe6">OBF</a></div><div class="ttdeci">#define OBF</div><div class="ttdef"><b>Definition:</b> i8042.h:27</div></div>
<div class="ttc" id="ai8042_8h_html_acfb42dde389e8ca36ab267002fbf5c6a"><div class="ttname"><a href="i8042_8h.html#acfb42dde389e8ca36ab267002fbf5c6a">OUT_BUF</a></div><div class="ttdeci">#define OUT_BUF</div><div class="ttdef"><b>Definition:</b> i8042.h:12</div></div>
<div class="ttc" id="akeyboard_8c_html_abba7b628c6f4f364050f0e43ac59793c"><div class="ttname"><a href="keyboard_8c.html#abba7b628c6f4f364050f0e43ac59793c">read_kbc</a></div><div class="ttdeci">int read_kbc()</div><div class="ttdoc">Manipulador de interrupção do teclado.</div><div class="ttdef"><b>Definition:</b> keyboard.c:35</div></div>
<div class="ttc" id="ai8042_8h_html_a1f7e79cfe81dc06414550fa52418941e"><div class="ttname"><a href="i8042_8h.html#a1f7e79cfe81dc06414550fa52418941e">STATUS_REG</a></div><div class="ttdeci">#define STATUS_REG</div><div class="ttdef"><b>Definition:</b> i8042.h:11</div></div>
<div class="ttc" id="autils_8c_html_a82a2a61273cf5ac5e31ca3eca5a24cea"><div class="ttname"><a href="utils_8c.html#a82a2a61273cf5ac5e31ca3eca5a24cea">util_sys_inb</a></div><div class="ttdeci">int util_sys_inb(int port, uint8_t *val)</div><div class="ttdoc">Invoca o sys_inb() mas lê o valor num uint8_t.</div><div class="ttdef"><b>Definition:</b> utils.c:19</div></div>
<div class="ttc" id="akeyboard_8c_html_a325819a8e492ac69542e8b31705af6e9"><div class="ttname"><a href="keyboard_8c.html#a325819a8e492ac69542e8b31705af6e9">data</a></div><div class="ttdeci">uint8_t data</div><div class="ttdef"><b>Definition:</b> keyboard.c:10</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Gerado por &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
